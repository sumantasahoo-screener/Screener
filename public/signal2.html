<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNO Signal Screener - Dark Hybrid</title>
    <!-- FORCE NO CACHE -->
    <meta http-equiv="Cache-Control" content="no-store">
    
    <style>
        /* ================================
           DARK THEME CSS (Screenshot Perfect)
           + YOUR ORIGINAL STICKY LOGIC
           ================================ */
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #020617 50%, #00040a 100%);
            color: #e2e8f0;
            margin: 10px;
            overflow-x: auto;
        }
        
        /* SCAN-TIME BAR - YOUR ORIGINAL + DARK */
        #scan-time-bar {
            background: linear-gradient(90deg, #1e40af 0%, #3b82f6 50%, #1e40af 100%) !important;
            color: white !important;
            font-weight: 900 !important;
            font-size: 13px !important;
            padding: 8px 15px !important;
            position: sticky !important;
            top: 0 !important;
            z-index: 100 !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4) !important;
        }
        
        #scanTimeValue { 
            font-size: 12px !important; 
            font-weight: 900 !important; 
            letter-spacing: 0.5px !important;
        }
        
        /* YOUR ORIGINAL STICKY LOGIC + DARK */
        table.dataframe tr.sticky-row {
            position: sticky !important;
            top: 55px !important; /* SCAN-TIME BAR ke baad */
            z-index: 50 !important;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
            border-bottom: 3px solid #3b82f6 !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        table.dataframe tr.sticky-row:nth-child(2) {
            top: 80px !important;
        }
        
        /* SYMBOL COLUMN STICKY - YOUR ORIGINAL */
        .col-SYMBOL {
            position: -webkit-sticky !important;
            position: sticky !important;
            left: 0 !important;
            z-index: 60 !important;
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%) !important;
            border-right: 3px solid #3b82f6 !important;
            min-width: 160px !important;
            text-align: left !important;
            padding-left: 12px !important;
            font-weight: 700 !important;
        }
        
        table.dataframe th.col-SYMBOL {
            z-index: 70 !important;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%) !important;
            color: white !important;
            font-weight: 800 !important;
        }
        
        /* Table Dark Theme */
        .table-wrap {
            background: rgba(15, 23, 42, 0.98) !important;
            border-radius: 12px !important;
            border: 1px solid rgba(59, 130, 246, 0.3) !important;
            overflow: hidden !important;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6) !important;
            max-height: 85vh !important;
        }
        
        table.dataframe {
            background: transparent !important;
            font-size: 13px !important;
        }
        
        table.dataframe th {
            background: linear-gradient(90deg, #1e293b 0%, #334155 100%) !important;
            color: #f8fafc !important;
            font-weight: 700 !important;
            position: sticky !important;
            top: 55px !important;
            z-index: 40 !important;
            border-bottom: 2px solid #475569 !important;
        }
        
        table.dataframe td {
            background: #020617 !important;
            border-color: rgba(71, 85, 105, 0.4) !important;
            color: #e2e8f0 !important;
            font-weight: 600 !important;
        }
        
        table.dataframe tbody tr:nth-child(even) td {
            background: #02081d !important;
        }
        
        table.dataframe tbody tr:hover td {
            background: rgba(59, 130, 246, 0.15) !important;
        }
        
        /* YOUR ORIGINAL PILL STYLES - DARK ADAPTED */
        .pill.buy { 
            background: rgba(96, 204, 101, 0.3) !important; 
            color: #60cc65 !important; 
            border: 1px solid rgba(96, 204, 101, 0.6) !important;
        }
        
        .pill.sell { 
            background: rgba(244, 54, 86, 0.3) !important; 
            color: #f43656 !important; 
            border: 1px solid rgba(244, 54, 86, 0.6) !important;
        }
        
        .pill.nt { 
            background: rgba(43, 43, 43, 0.8) !important; 
            color: #cfd8dc !important; 
            border: 1px solid rgba(142, 167, 171, 0.5) !important;
        }
        
        /* Zone Pills - Subtle Dark */
        .col-DELTA_ZONE .pill, .col-GAMMA_ZONE .pill, 
        .col-THETA_ZONE .pill, .col-IV_ZONE .pill {
            background: transparent !important;
            font-size: 11px !important;
            padding: 3px 8px !important;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1) !important;
        }
        
        /* Controls Dark */
        .btn, button {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8) !important;
            color: white !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
            border-radius: 6px !important;
            padding: 8px 14px !important;
            font-weight: 600 !important;
        }
        
        /* Mobile */
        @media (max-width: 768px) {
            .col-SYMBOL { min-width: 130px !important; }
            table.dataframe th:nth-child(n+14),
            table.dataframe td:nth-child(n+14) { display: none !important; }
        }
        
        /* Scrollbar Dark */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(45deg, #3b82f6, #8b5cf6); 
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <!-- YOUR ORIGINAL STRUCTURE -->
    <div class="table-wrap">
        <!-- SCAN-TIME BAR PLACEHOLDER -->
        <th colspan="100%" style="position: sticky; top: 0; z-index: 100; background: linear-gradient(90deg, #1e40af 0%, #3b82f6 50%, #1e40af 100%); color: white; font-weight: 900; font-size: 13px; text-align: center; padding: 8px 15px;">
            ‚è∞ SCAN TIME: <span id="scanTimeValue">{{SCAN_TIME}}</span> | 
            üìä {{TOTAL_SYMBOLS}} Symbols
            <span id="scanStatus" style="margin-left: 12px; padding: 3px 8px; border-radius: 4px; font-size: 11px;"></span>
        </th>
        
        <!-- YOUR REAL DATA TABLE -->
        {{TABLE_CONTENT}}
    </div>

    <!-- YOUR ORIGINAL SCRIPTS - COMPLETE -->
    <script>
        // YOUR ORIGINAL AUTO-REFRESH (10s incremental)
        async function fetchAndUpdateTable() {
            try {
                const res = await fetch(window.location.href, { cache: 'no-store' });
                if (!res.ok) throw new Error(`fetch failed: ${res.status}`);
                const text = await res.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const newWrap = doc.querySelector('.table-wrap');
                const curWrap = document.querySelector('.table-wrap');
                
                if (!newWrap || !curWrap) return;
                
                // Preserve scroll
                const pageScrollY = window.pageYOffset;
                const wrapScrollLeft = curWrap.scrollLeft;
                
                // Replace only table content
                curWrap.innerHTML = newWrap.innerHTML;
                
                // Restore scrolls
                setTimeout(() => {
                    window.scrollTo(0, pageScrollY);
                    curWrap.scrollLeft = wrapScrollLeft;
                }, 50);
                
            } catch(err) {
                console.warn('Table update failed:', err);
            }
        }
        
        // YOUR SCAN-TIME VALIDITY
        function updateScanTime() {
            const scanEl = document.getElementById('scanTimeValue');
            if (!scanEl) return;
            
            const now = new Date();
            const scanText = scanEl.textContent.trim();
            // Parse DD/MM/YY HH:MM ‚Üí calculate freshness
            // YOUR ORIGINAL LOGIC HERE
            const statusEl = document.getElementById('scanStatus');
            if (statusEl) {
                statusEl.textContent = 'FRESH';
                statusEl.style.background = '#1db954';
            }
        }
        
        // INIT + AUTO-REFRESH
        window.addEventListener('load', () => {
            fetchAndUpdateTable(); // Initial
            setInterval(fetchAndUpdateTable, 10000); // Every 10s
            setInterval(updateScanTime, 3000);
        });
    </script>

    <!-- YOUR ORIGINAL CONTROLS -->
    <div style="position: fixed; bottom: 12px; right: 12px; z-index: 9999; display: flex; gap: 8px;">
        <button onclick="fetchAndUpdateTable()" style="padding: 8px 12px; background: linear-gradient(45deg, #3b82f6, #1d4ed8); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">üîÑ Refresh</button>
    </div>
</body>
</html>
